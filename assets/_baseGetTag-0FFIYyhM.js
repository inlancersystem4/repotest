import{_ as G,b as E,f as R,r as m,o as l,d as p,w as d,a as i,y as f,G as b,c as _,j as k,g as v,t as g,Z as O,e as S,F as I,n as q,i as y,E as Z,B as H,C as J}from"./index-CObJ0xdd.js";import{C as K}from"./CommonModalLayout-BJWFpzOf.js";import{_ as Q}from"./deleteicon-9Y-d_GsD.js";import{Z as X,o as Y,l as $,a as ee}from"./combobox-wrqH_vu8.js";import{I as te,j as ie,A as se,F as ne}from"./listbox-B5_UOFQ8.js";import{c as A}from"./_commonjsHelpers-BosuxZz1.js";const ae="https://stagingapi.fandfrestaurants.com/admin",le={components:{Listbox:te,ListboxButton:ie,ListboxOptions:se,ListboxOption:ne,CommonModalLayout:K,Combobox:X,ComboboxInput:Y,ComboboxOptions:$,ComboboxOption:ee},props:{isOpen:Boolean,itemList:Array,packSizeList:Array,ingredientList:Array,calculation:Object},data(){return{formName:"Add a Calculation",alertStore:E(),formSubmitted:!1,btnLoading:!1,ingredientArray:[{ingredient:"",calc_id:"",ingredientName:"",weight:"",unit:"",price:""}],calories:"",allergies:"",priceWithVAT:"",selectedItem:"",name:"",selectIngredientUnit:"",hasEmptyIngredient:"",finalIngredientArray:[],priceWithVATDisable:!1,calculationId:""}},mounted(){this.updateCalculationData()},computed:{totalCost(){return parseFloat(this.ingredientArray.reduce((e,t)=>e+parseFloat(t.price||0),0)).toFixed(5)},ratio(){const e=(this.priceWithVAT/this.totalCost).toFixed(5);return isFinite(e)?e:"-"},calculatedPrices(){return this.ingredientArray.map(e=>{if(!isNaN(e.weight)&&e.weight!==""){const t=(parseFloat(e.weight)*parseFloat(e.unit_base_weight)*parseFloat(e.ingredient_price_per_unit)).toFixed(5);return e.price=t,t}else return e.price="",""})}},watch:{isOpen(){this.calculationId&&this.calculation.calc_id?this.formName="Edit Calculation  - "+this.calculation.calc_name:this.formName="Add a Calculation"},calculation(e){e?this.updateCalculationData():this.clearFields()}},methods:{closeModal(){this.$emit("close_modal",1)&&(this.calculationId="",this.formName="Add a Calculation"),this.calculationId="",this.$emit("close_modal"),this.clearFields()},getImageId(e){this.selectedImgSend=e},clearFields(){this.calculationId="",this.calories="",this.allergies="",this.priceWithVAT="",this.selectedItem="",this.name="",this.selectIngredientUnit="",this.formSubmitted=!1,this.ingredientArrayErrorMessage="",this.ingredientArray=[{calc_id:"",ingredient:"",ingredientName:"",weight:"",unit:"",price:""}]},addIngredient(){this.ingredientArray.push({ingredient:"",calc_id:"",ingredientName:"",weight:"",unit:"",price:""})},removeIngredient(e){this.ingredientArray.splice(e,1),this.updateIngredientPrices()},removeIngredientName(e){this.ingredientArray[e]={calc_id:"",ingredient:"",ingredientName:"",weight:"",unit:"",price:""}},updateCalculationData(){if(this.calculation){const e=[];this.calculationId=this.calculation.calc_id,this.name=this.calculation.calc_name,this.allergies=this.calculation.calc_allergies,this.calories=this.calculation.calc_calories,this.priceWithVAT=this.calculation.calc_price_inc_vat;for(let t=0;t<this.calculation.ingre_calc_list.length;t++){const n=this.calculation.ingre_calc_list[t],u=this.packSizeList.filter(a=>a.unit_id==n.ingre_calc_unit_id);e.push({calc_id:n.ingre_calc_id,ingredient:n.ingredient_id,ingredient_supplier:n.supplier_name,ingredientName:`${n.ingre_calc_ingredient} - ${n.supplier_name||""}`,weight:n.ingre_calc_weight,unit:n.ingre_calc_unit_id,unit_base_weight:u.length>0?parseFloat(u[0].unit_base_weight):1,filteredPackSizeList:n.ingre_calc_unit_base_id?this.packSizeList.filter(a=>a.unit_base_id===n.ingre_calc_unit_base_id||a.unit_id===n.ingre_calc_unit_base_id):this.packSizeList.filter(a=>a.unit_base_id===n.ingre_calc_unit_id||a.unit_id===n.ingre_calc_unit_id),price:0,ingredient_price_per_unit:n.ingredient_price_per_unit})}if(this.calculation.calc_item_id!=null&&this.calculation.calc_item_id!=""){const t=this.itemList.filter(n=>n.item_id==this.calculation.calc_item_id);t!=null&&t.length>0&&(this.selectedItem=t[0])}this.ingredientArray=e}else this.formName="Add a Calculation"},getSelectedItemData(e){this.priceWithVATDisable=!0,this.priceWithVAT=e.selling_price},removeSelectItem(){this.selectedItem="",this.priceWithVATDisable=!1},selectedPackSize(e,t){this.ingredientArray[t].unit=e.unit_id,this.ingredientArray[t].unit_base_weight=e.unit_base_weight},getUnitName(e){const t=this.packSizeList.find(n=>n.unit_id===e);return t?t.unit_name:""},filterIngredientList(e){this.$emit("search_ingredient",e)},filterMenuItemList(e){this.$emit("search_menu_item",e)},filterPackSizeListBaseId(e,t){const n=this.packSizeList.filter(u=>u.unit_base_id==e||u.unit_id==e);this.ingredientArray[t].filteredPackSizeList=n},filterPackSizeListUnitId(e,t){const n=this.packSizeList.filter(u=>u.unit_base_id==e||u.unit_id==e);this.ingredientArray[t].filteredPackSizeList=n},selectedIngredient(e,t){this.ingredientArray[t].ingredient=e.ingredient_id,this.ingredientArray[t].ingredientName=e.ingredient_item,this.ingredientArray[t].ingredient_supplier=e.ingredient_supplier,this.ingredientArray[t].unit=e.ingredient_pack_units_id,this.ingredientArray[t].ingredient_price_per_unit=e.ingredient_price_per_unit;const n=this.packSizeList.find(u=>u.unit_id==e.ingredient_pack_units_id);this.ingredientArray[t].unit_base_weight=n.unit_base_weight,e.ingredient_units_base_id?this.filterPackSizeListBaseId(e.ingredient_units_base_id,t):this.filterPackSizeListUnitId(e.ingredient_pack_units_id,t)},updatedNewingredientArray(){const e=this.ingredientArray.map(t=>({ingredient:t.ingredient,weight:t.weight,unit:t.unit,calc_id:t.calc_id?t.calc_id:"",price:t.price}));this.finalIngredientArray=e},async updateCalculation(){this.updatedNewingredientArray(),this.formSubmitted=!0,this.btnLoading=!0;var e=new FormData;e.append("calc_id",this.calculationId||""),e.append("menu_calc_name",this.name),e.append("menu_calc_item",this.selectedItem.item_id||""),e.append("menu_calc_price_inc_vat",this.priceWithVAT),e.append("mane_calc_calories",this.calories||""),e.append("mane_calc_allergies",this.allergies||""),e.append("ingre_calc_ingredient",JSON.stringify(this.finalIngredientArray));try{const t=await R.post(`${ae}/add-calculations`,e);t.success==1?(this.calculationId="",this.$emit("close_modal",1),this.clearFields(),this.btnLoading=!1):(this.btnLoading=!1,this.alertStore.error(t.message))}catch(t){this.alertStore.error(t)}}}},c=e=>(H("data-v-37864b1f"),e=e(),J(),e),oe={class:"w-full"},re={class:"space-y-3 pb-6 w-full"},ce={class:"space-y-1"},de={class:"input--group"},ue=c(()=>i("label",{for:"Name"},[y("Name"),i("span",{class:"text-red-600"},"*")],-1)),_e={class:"input--group"},pe=c(()=>i("label",null,null,-1)),me={key:0,class:"error--message !text-left flex-1"},he={class:"space-y-1"},ge={class:"input--group"},fe=c(()=>i("label",{for:"Supplier"},"Link to menu item",-1)),be={class:"relative flex items-center gap-2 w-full"},ye={key:0,class:"flex items-center gap-1.5 px-2 min-h-[46px] w-full max-h-[46px] justify-between"},ve={class:"line-clamp-1"},xe={class:"flex items-center gap-2"},we=["src","alt"],ke=c(()=>i("p",{class:"!text-center"},"Oops, data not found!",-1)),Se={class:"grid grid-cols-2 w-full"},Ie={class:"input--group w-full"},Ae=c(()=>i("label",{for:"VAT"},[y("Price including VAT"),i("span",{class:"text-red-600"},"*")],-1)),Le=["disabled"],Ce={class:"input--group w-full !pl-24"},Ve=c(()=>i("label",{for:"Ratio",class:"!max-w-[80px] !min-w-[80px]"},"Ratio",-1)),Te={class:"input--group"},Oe=c(()=>i("label",null,null,-1)),je={key:0,class:"error--message !text-left flex-1"},Ne={class:"border-t border-solid w-full space-y-3 pt-6 pb-6 border-base-color"},ze={class:"space-y-1"},Ue={class:"input--group !flex-col !items-start"},Pe=c(()=>i("label",null,[y("Ingredient"),i("span",{class:"text-red-600"},"*")],-1)),Fe={class:"space-y-1.5"},We={class:"min-w-[30%] max-w-[30%]"},De={key:0,class:"flex items-center gap-1.5 px-2 min-h-[44px] max-h-[44px] justify-between"},Be={class:"line-clamp-1 text-nowrap block"},Me=["onClick"],Ge=c(()=>i("p",{class:"!text-center"},"Oops, data not found!",-1)),Ee={class:"min-w-[20%] max-w-[20%]"},Re=["onUpdate:modelValue"],qe={class:"min-w-[20%] max-w-[20%]"},Ze={class:"relative flex items-center justify-center"},He={key:0,class:"block"},Je={key:1,class:"block"},Ke=c(()=>i("span",{class:"min-w-[24px] min-h-[24px] max-w-[24px] max-h-[24px]"},[i("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M19.5 9L12 16.5L4.5 9",class:"stroke-base-color","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),Qe=c(()=>i("p",{class:"!text-center"},"Oops, data not found!",-1)),Xe={class:"min-w-[20%] max-w-[20%]"},Ye=["onUpdate:modelValue"],$e=["onClick","disabled"],et=c(()=>i("img",{src:Q,alt:"delete row",class:"w-6 h-auto"},null,-1)),tt=[et],it={key:0,class:"error--message !text-left flex-1"},st={class:"border-t border-solid w-full space-y-3 pt-6 border-base-color"},nt={class:"space-y-1"},at={class:"input--group"},lt=c(()=>i("label",{for:"Cost"},"Cost",-1)),ot=["value"],rt={class:"space-y-1"},ct={class:"input--group"},dt=c(()=>i("label",{for:"calories"},"Calories",-1)),ut={class:"space-y-1"},_t={class:"input--group"},pt=c(()=>i("label",{for:"Allergies"},"Allergies",-1)),mt=["disabled"],ht={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},gt=c(()=>i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),ft=c(()=>i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),bt=[gt,ft];function yt(e,t,n,u,a,r){const L=m("ComboboxInput"),C=m("ComboboxOption"),w=m("ComboboxOptions"),V=m("Combobox"),F=m("ListboxButton"),W=m("ListboxOption"),T=m("ListboxOptions"),D=m("Listbox"),B=m("CommonModalLayout");return l(),p(B,{isOpen:n.isOpen,modal_title:a.formName,onClose_modal:r.closeModal,manualClass:"max-w-4xl calculaion--modal"},{default:d(()=>[i("form",{class:"space-y-10 flex w-full flex-col items-end",onSubmit:t[10]||(t[10]=Z((...s)=>r.updateCalculation&&r.updateCalculation(...s),["prevent"]))},[i("div",oe,[i("div",re,[i("div",ce,[i("div",de,[ue,f(i("input",{type:"text",id:"Name","onUpdate:modelValue":t[0]||(t[0]=s=>a.name=s)},null,512),[[b,a.name,void 0,{trim:!0}]])]),i("div",_e,[pe,a.formSubmitted&&!a.name?(l(),_("p",me," name is required ")):k("",!0)])]),i("div",he,[i("div",ge,[fe,v(V,{modelValue:a.selectedItem,"onUpdate:modelValue":t[3]||(t[3]=s=>a.selectedItem=s),class:"custom--select min-h-[46px] max-h-[46px]"},{default:d(()=>[i("div",be,[a.selectedItem?(l(),_("div",ye,[i("span",ve,g(a.selectedItem.english_name),1),i("button",{type:"button",onClick:t[1]||(t[1]=(...s)=>r.removeSelectItem&&r.removeSelectItem(...s))},"x")])):(l(),p(L,{key:1,placeholder:"Search Menu Item",onInput:t[2]||(t[2]=s=>r.filterMenuItemList(s.target.value)),class:"!border-none"})),v(O,{"leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:d(()=>[n.itemList&&n.itemList.length>0?(l(),p(w,{key:0,class:"select--option"},{default:d(()=>[(l(!0),_(I,null,S(n.itemList,s=>(l(),p(C,{onClick:h=>r.getSelectedItemData(s),key:s.name,value:s,as:"div",class:"option"},{default:d(()=>[i("div",xe,[i("img",{src:s.item_image,alt:s.english_name,width:"50px",height:"auto",class:"object-contain"},null,8,we),y(" "+g(s.english_name),1)])]),_:2},1032,["onClick","value"]))),128))]),_:1})):(l(),p(w,{key:1,class:"select--option"},{default:d(()=>[ke]),_:1}))]),_:1})])]),_:1},8,["modelValue"])])]),i("div",Se,[i("div",Ie,[Ae,f(i("input",{type:"number",id:"VAT","onUpdate:modelValue":t[4]||(t[4]=s=>a.priceWithVAT=s),step:"000.001",disabled:a.priceWithVATDisable},null,8,Le),[[b,a.priceWithVAT,void 0,{trim:!0}]])]),i("div",Ce,[Ve,f(i("input",{type:"text",id:"Ratio","onUpdate:modelValue":t[5]||(t[5]=s=>r.ratio=s),disabled:""},null,512),[[b,r.ratio,void 0,{trim:!0}]])]),i("div",Te,[Oe,a.formSubmitted&&!a.priceWithVAT?(l(),_("p",je," Price including VAT is required ")):k("",!0)])])]),i("div",Ne,[i("div",ze,[i("div",Ue,[Pe,i("ul",Fe,[(l(!0),_(I,null,S(a.ingredientArray,(s,h)=>(l(),_("li",{class:"flex items-stretch gap-1.5",key:h},[i("div",We,[v(V,{modelValue:s.ingredient,"onUpdate:modelValue":o=>s.ingredient=o,class:"custom--select",as:"div"},{default:d(()=>[s.ingredientName?(l(),_("div",De,[i("span",Be,g(s.ingredientName)+" "+g(s.ingredient_supplier),1),i("button",{type:"button",onClick:o=>r.removeIngredientName(h)},"x",8,Me)])):(l(),p(L,{key:1,placeholder:"Search",onInput:t[6]||(t[6]=o=>r.filterIngredientList(o.target.value)),class:"!border-none",modelValue:s.ingredient,"onUpdate:modelValue":o=>s.ingredient=o},null,8,["modelValue","onUpdate:modelValue"])),n.ingredientList&&n.ingredientList.length>0?(l(),p(w,{key:2,class:"select--option"},{default:d(()=>[(l(!0),_(I,null,S(n.ingredientList,o=>(l(),p(C,{key:o.id,value:o,class:"option",onClick:M=>r.selectedIngredient(o,h)},{default:d(()=>[y(g(o.ingredient_item)+" - "+g(o.ingredient_supplier),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)):(l(),p(w,{key:3,class:"select--option"},{default:d(()=>[Ge]),_:1}))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),i("div",Ee,[f(i("input",{type:"number",placeholder:"Weight","onUpdate:modelValue":o=>s.weight=o,step:"000.001"},null,8,Re),[[b,s.weight]])]),i("div",qe,[v(D,{modelValue:s.unit,"onUpdate:modelValue":o=>s.unit=o,class:"custom--select min-h-[46px] max-h-[46px]"},{default:d(()=>[i("div",Ze,[v(F,{class:"flex items-center justify-between w-full px-2 py-1.5"},{default:d(()=>[s.unit?(l(),_("span",He,g(r.getUnitName(s.unit)),1)):(l(),_("span",Je," Select Unit ")),Ke]),_:2},1024),v(O,{"leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:d(()=>[n.packSizeList&&n.packSizeList.length>0?(l(),p(T,{key:0,class:"select--option !min-w-[150px]"},{default:d(()=>[(l(!0),_(I,null,S(s.filteredPackSizeList,o=>(l(),p(W,{key:o.name,value:o,as:"div",class:"option",onClick:M=>r.selectedPackSize(o,h)},{default:d(()=>[y(g(o.unit_name),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)):(l(),p(T,{key:1,class:"select--option"},{default:d(()=>[Qe]),_:1}))]),_:2},1024)])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),i("div",Xe,[f(i("input",{type:"text",placeholder:"Price","onUpdate:modelValue":o=>r.calculatedPrices[h]=o,disabled:""},null,8,Ye),[[b,r.calculatedPrices[h]]])]),i("button",{class:"flex items-center justify-center w-20 disabled:cursor-no-drop disabled:opacity-50",type:"button",onClick:o=>r.removeIngredient(h),disabled:a.ingredientArray.length==1},tt,8,$e)]))),128)),a.formSubmitted&&a.hasEmptyIngredient?(l(),_("p",it," All fields in the ingredient array are required. ")):k("",!0)]),i("button",{onClick:t[7]||(t[7]=(...s)=>r.addIngredient&&r.addIngredient(...s)),type:"button",class:"btn--regular fill max-w-[38px] text-lg h-[42px] max-h-[42px] flex items-center justify-center"}," + ")])])]),i("div",st,[i("div",nt,[i("div",at,[lt,i("input",{type:"text",id:"Cost",value:r.totalCost,disabled:""},null,8,ot)])]),i("div",rt,[i("div",ct,[dt,f(i("input",{type:"number",id:"calories","onUpdate:modelValue":t[8]||(t[8]=s=>a.calories=s),step:"000.001"},null,512),[[b,a.calories,void 0,{trim:!0}]])])]),i("div",ut,[i("div",_t,[pt,f(i("input",{type:"text",id:"Allergies","onUpdate:modelValue":t[9]||(t[9]=s=>a.allergies=s)},null,512),[[b,a.allergies]])])])])]),i("button",{class:q(["modal--form_btn",{"btn--loader":a.btnLoading}]),type:"submit",disabled:a.btnLoading},[a.btnLoading?(l(),_("svg",ht,bt)):k("",!0),y(" Save ")],10,mt)],32)]),_:1},8,["isOpen","modal_title","onClose_modal"])}const Ht=G(le,[["render",yt],["__scopeId","data-v-37864b1f"]]);var vt=typeof A=="object"&&A&&A.Object===Object&&A,xt=vt,wt=xt,kt=typeof self=="object"&&self&&self.Object===Object&&self,St=wt||kt||Function("return this")(),It=St,At=It,Lt=At.Symbol,U=Lt,j=U,P=Object.prototype,Ct=P.hasOwnProperty,Vt=P.toString,x=j?j.toStringTag:void 0;function Tt(e){var t=Ct.call(e,x),n=e[x];try{e[x]=void 0;var u=!0}catch{}var a=Vt.call(e);return u&&(t?e[x]=n:delete e[x]),a}var Ot=Tt,jt=Object.prototype,Nt=jt.toString;function zt(e){return Nt.call(e)}var Ut=zt,N=U,Pt=Ot,Ft=Ut,Wt="[object Null]",Dt="[object Undefined]",z=N?N.toStringTag:void 0;function Bt(e){return e==null?e===void 0?Dt:Wt:z&&z in Object(e)?Pt(e):Ft(e)}var Jt=Bt;export{Ht as C,It as _,Jt as a};

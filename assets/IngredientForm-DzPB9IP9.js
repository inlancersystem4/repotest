import{_ as U,b as P,f as B,r as m,o as l,d as u,w as r,a as e,y as b,G as k,c as o,j as _,g as h,t as g,Z as S,e as w,F as L,i as c,n as z,E as V,B as C,C as A}from"./index-CObJ0xdd.js";import{C as W}from"./CommonModalLayout-BJWFpzOf.js";import{I as O,j as F,A as j,F as M}from"./listbox-B5_UOFQ8.js";const N="https://stagingapi.fandfrestaurants.com/admin",D={components:{Listbox:O,ListboxButton:F,ListboxOptions:j,ListboxOption:M,CommonModalLayout:W},props:{isOpen:Boolean,packSizeList:Array,supplierList:Array,ingredient:Object},data(){return{alertStore:P(),formSubmitted:!1,btnLoading:!1,selectSupplier:null,selectPackSize:"",vat:"",packWeight:"",selectItem:"",selectedUnitBase:null,selectedUnitBaseLabel:null,ingredientId:"",formName:"Add a Ingredient"}},created(){},watch:{isOpen(){this.ingredientId&&this.ingredient.ingredient_id?this.formName="Edit Ingredient - "+this.ingredient.ingredient_item:this.formName="Add a Ingredient"},ingredient(i){i?this.updateIngredientData():this.clearFields()}},computed:{pUnitPrice(){return!this.vat||!this.packWeight||!this.selectedUnitBase||this.packWeight===0||this.vat===0||this.selectedUnitBase===0?0:(this.vat/(this.packWeight*this.selectedUnitBase)).toFixed(5)}},mounted(){this.updateIngredientData()},methods:{calculateAgain(){return!this.vat||!this.packWeight||!this.selectedUnitBase||this.packWeight===0||this.vat===0||this.selectedUnitBase===0?0:(this.vat/(this.packWeight*this.selectedUnitBase)).toFixed(5)},closeModal(){this.$emit("close_modal",1)&&(this.ingredientId="",this.formName="Add a Ingredient"),this.ingredientId="",this.$emit("close_modal"),this.clearFields()},clearFields(){this.selectPackSize="",this.selectSupplier=null,this.vat="",this.selectItem="",this.packWeight="",this.formSubmitted=!1},selectedUnit(i){if(this.selectedUnitBase=i.unit_base_weight,i.unit_is_base==1)this.selectedUnitBaseLabel=i.unit_name;else{const s=this.packSizeList.filter(d=>d.unit_id==i.unit_base_id);this.selectedUnitBaseLabel=s[0].unit_name}},updateIngredientData(){if(this.ingredient){const i=this.packSizeList.filter(s=>s.unit_id==this.ingredient.ingredient_pack_units_id);this.selectedUnitBase=i[0].unit_base_weight,this.selectedUnitBaseLabel=i[0].unit_name,this.selectSupplier={supplier_id:this.ingredient.ingredient_supplier_id,supplier_name:this.ingredient.ingredient_supplier},this.selectPackSize={unit_id:this.ingredient.ingredient_pack_units_id,unit_name:this.ingredient.ingredient_pack_units},this.vat=this.ingredient.ingredient_price_include_vat,this.packWeight=this.ingredient.ingredient_pack_weight,this.selectItem=this.ingredient.ingredient_item,this.pUnitPrice=this.ingredient.ingredient_price_per_unit,this.ingredientId=this.ingredient.ingredient_id,this.calculateAgain()}else this.formName="Add a Ingredient"},async updateIngredient(){if(this.formSubmitted=!0,this.btnLoading=!0,!this.selectPackSize||!this.selectSupplier||!this.vat||!this.pUnitPrice||!this.selectItem||!this.packWeight){this.btnLoading=!1;return}var i=new FormData;this.ingredientId?i.append("ingredient_id",this.ingredientId):i.append("ingredient_id",""),i.append("ingredient_item",this.selectItem),i.append("ingredient_supplier",this.selectSupplier.supplier_id),i.append("ingredient_price_include_vat",this.vat),i.append("ingredient_pack_weight",this.packWeight),i.append("ingredient_pack_units",this.selectPackSize.unit_id),i.append("ingredient_price_per_unit",this.pUnitPrice);try{const s=await B.post(`${N}/add-ingredient`,i);s.success==1?(this.$emit("close_modal",1),this.clearFields(),this.btnLoading=!1):(this.btnLoading=!1,this.alertStore.error(s.message))}catch(s){this.alertStore.error(s)}}}},a=i=>(C("data-v-45cdbe0d"),i=i(),A(),i),T={class:"w-full"},q={class:"space-y-3 pb-6 w-full"},E={class:"space-y-1"},G={class:"input--group"},H=a(()=>e("label",{for:"item"},[c("Item"),e("span",{class:"text-red-600"},"*")],-1)),Z={class:"input--group"},J=a(()=>e("label",null,null,-1)),K={key:0,class:"error--message !text-left flex-1"},Q={class:"space-y-1"},R={class:"input--group"},X=a(()=>e("label",{for:"Supplier"},[c("Supplier"),e("span",{class:"text-red-600"},"*")],-1)),Y={class:"relative flex items-center justify-center"},$={key:0,class:"block"},ee={key:1,class:"block"},te=a(()=>e("span",{class:"min-w-[24px] min-h-[24px] max-w-[24px] max-h-[24px]"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M19.5 9L12 16.5L4.5 9",class:"stroke-base-color","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),ie=a(()=>e("p",{class:"!text-center"},"Oops, data not found!",-1)),se={class:"input--group"},ne=a(()=>e("label",null,null,-1)),le={key:0,class:"error--message !text-left flex-1"},ae={class:"space-y-1"},oe={class:"input--group"},re=a(()=>e("label",{for:"VAT"},[c("Price including VAT"),e("span",{class:"text-red-600"},"*")],-1)),de={class:"input--group"},ce=a(()=>e("label",null,null,-1)),pe={key:0,class:"error--message !text-left flex-1"},ue={class:"space-y-1"},_e={class:"input--group"},he=a(()=>e("label",{for:"Packsize"},[c("Pack size"),e("span",{class:"text-red-600"},"*")],-1)),me={class:"grid grid-cols-2 gap-3"},ge={class:"space-y-1"},fe={key:0,class:"error--message !text-left flex-1"},be={class:"space-y-1"},ke={class:"relative flex items-center justify-center"},xe={key:0,class:"block"},ve={key:1,class:"block"},ye=a(()=>e("span",{class:"min-w-[24px] min-h-[24px] max-w-[24px] max-h-[24px]"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M19.5 9L12 16.5L4.5 9",class:"stroke-base-color","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),Se=a(()=>e("p",{class:"!text-center"},"Oops, data not found!",-1)),we={key:0,class:"error--message !text-left flex-1"},Le={class:"border-t border-solid w-full border-base-color"},Ie={class:"space-y-1 pt-6"},Ue={class:"input--group"},Pe={key:0,for:"pUnitPrice"},Be=a(()=>e("span",{class:"text-red-600"},"*",-1)),ze={key:1,for:"pUnitPrice"},Ve=a(()=>e("span",{class:"text-red-600"},"*",-1)),Ce={class:"input--group"},Ae=a(()=>e("label",null,null,-1)),We={key:0,class:"error--message !text-left flex-1"},Oe=["disabled"],Fe={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},je=a(()=>e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1)),Me=a(()=>e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)),Ne=[je,Me];function De(i,s,d,Te,t,p){const x=m("ListboxButton"),v=m("ListboxOption"),f=m("ListboxOptions"),y=m("Listbox"),I=m("CommonModalLayout");return l(),u(I,{isOpen:d.isOpen,modal_title:t.formName,onClose_modal:p.closeModal,manualClass:"max-w-xl ingredient--modal"},{default:r(()=>[e("form",{class:"space-y-10 flex w-full flex-col items-end",onSubmit:s[6]||(s[6]=V((...n)=>p.updateIngredient&&p.updateIngredient(...n),["prevent"]))},[e("div",T,[e("div",q,[e("div",E,[e("div",G,[H,b(e("input",{type:"text",id:"item","onUpdate:modelValue":s[0]||(s[0]=n=>t.selectItem=n)},null,512),[[k,t.selectItem,void 0,{trim:!0}]])]),e("div",Z,[J,t.formSubmitted&&!t.selectItem?(l(),o("p",K," item is required ")):_("",!0)])]),e("div",Q,[e("div",R,[X,h(y,{modelValue:t.selectSupplier,"onUpdate:modelValue":s[1]||(s[1]=n=>t.selectSupplier=n),class:"custom--select"},{default:r(()=>[e("div",Y,[h(x,{class:"flex items-center justify-between w-full px-2 py-1.5"},{default:r(()=>[t.selectSupplier?(l(),o("span",$,g(t.selectSupplier.supplier_name),1)):(l(),o("span",ee,"Select Supplier")),te]),_:1}),h(S,{"leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:r(()=>[d.supplierList&&d.supplierList.length>0?(l(),u(f,{key:0,class:"select--option"},{default:r(()=>[(l(!0),o(L,null,w(d.supplierList,n=>(l(),u(v,{key:n.name,value:n,as:"div",class:"option"},{default:r(()=>[c(g(n.supplier_name),1)]),_:2},1032,["value"]))),128))]),_:1})):(l(),u(f,{key:1,class:"select--option"},{default:r(()=>[ie]),_:1}))]),_:1})])]),_:1},8,["modelValue"])]),e("div",se,[ne,t.formSubmitted&&!t.selectSupplier?(l(),o("p",le," Supplier is required ")):_("",!0)])]),e("div",ae,[e("div",oe,[re,b(e("input",{type:"number",id:"VAT",step:"00.001","onUpdate:modelValue":s[2]||(s[2]=n=>t.vat=n),class:"max-w-[140px] !mr-auto"},null,512),[[k,t.vat]])]),e("div",de,[ce,t.formSubmitted&&!t.vat?(l(),o("p",pe," Price including VAT is required ")):_("",!0)])]),e("div",ue,[e("div",_e,[he,e("div",me,[e("div",ge,[b(e("input",{type:"number",step:"000.001",id:"packWeight","onUpdate:modelValue":s[3]||(s[3]=n=>t.packWeight=n)},null,512),[[k,t.packWeight,void 0,{trim:!0}]]),t.formSubmitted&&!t.packWeight?(l(),o("p",fe," Pack weight is required ")):_("",!0)]),e("div",be,[h(y,{modelValue:t.selectPackSize,"onUpdate:modelValue":s[4]||(s[4]=n=>t.selectPackSize=n),class:"custom--select h-full"},{default:r(()=>[e("div",ke,[h(x,{class:"flex items-center justify-between w-full px-2 py-1.5 disabled:opacity-35",disabled:this.ingredientId!=""},{default:r(()=>[t.selectPackSize?(l(),o("span",xe,g(t.selectPackSize.unit_name),1)):(l(),o("span",ve,"Select Unit")),ye]),_:1},8,["disabled"]),h(S,{"leave-active-class":"transition duration-100 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:r(()=>[d.packSizeList&&d.packSizeList.length>0?(l(),u(f,{key:0,class:"select--option !max-h-[170px]"},{default:r(()=>[(l(!0),o(L,null,w(d.packSizeList,n=>(l(),u(v,{key:n.name,value:n,as:"div",class:"option",onClick:qe=>p.selectedUnit(n)},{default:r(()=>[c(g(n.unit_name),1)]),_:2},1032,["value","onClick"]))),128))]),_:1})):(l(),u(f,{key:1,class:"select--option"},{default:r(()=>[Se]),_:1}))]),_:1})])]),_:1},8,["modelValue"]),t.formSubmitted&&!t.selectPackSize?(l(),o("p",we," Pack Units is required ")):_("",!0)])])])])]),e("div",Le,[e("div",Ie,[e("div",Ue,[t.selectedUnitBaseLabel?(l(),o("label",ze,[c("Price per "+g(t.selectedUnitBaseLabel),1),Ve])):(l(),o("label",Pe,[c("Price per unit"),Be])),b(e("input",{type:"text",id:"pUnitPrice","onUpdate:modelValue":s[5]||(s[5]=n=>p.pUnitPrice=n),class:"max-w-[140px] !mr-auto",disabled:""},null,512),[[k,p.pUnitPrice,void 0,{trim:!0}]])]),e("div",Ce,[Ae,t.formSubmitted&&!p.pUnitPrice?(l(),o("p",We," Price per unit is required ")):_("",!0)])])])]),e("button",{class:z(["modal--form_btn",{"btn--loader":t.btnLoading}]),type:"submit",disabled:t.btnLoading},[t.btnLoading?(l(),o("svg",Fe,Ne)):_("",!0),c(" Save ")],10,Oe)],32)]),_:1},8,["isOpen","modal_title","onClose_modal"])}const Ze=U(D,[["render",De],["__scopeId","data-v-45cdbe0d"]]);export{Ze as I};
